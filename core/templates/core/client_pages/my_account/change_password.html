{% extends 'core/base.html' %}

{% load static %}

{% block title %} {{ title_change_password_view|default:"Смена пароля" }} {% endblock %}

{% block content %}


<section class="flex flex-col flex-1 bg-transparent dark:bg-gray-900 pt-6 md:pt-10 lg:pt-20">

    <!-- ========== СМЕНА ПАРОЛЯ ========== -->

    <div class="w-full flex-1 flex items-center py-8 md:py-0 -ml-8">

        <div class="w-full max-w-md mx-auto px-4">

            {% if password_changed %}
            <div class="mt-4 rounded-3xl border-1 border-teal-100 bg-teal-100/50 shadow-2xl shadow-teal-500/50 p-6 text-center">
                <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full">
                    <img src="{% static 'images/menu/success.svg' %}"
                         alt="success"
                         class="transition-transform duration-200 group-hover:scale-110">
                </div>
                <h2 class="mt-4 text-lg font-semibold text-teal-600">
                    Пароль успешно изменен!
                </h2>
            </div>
            {% else %}

            <h1 class="text-2xl text-center font-extrabold leading-tight tracking-wide text-zinc-400 md:text-4xl dark:text-white">
                Смена пароля
            </h1>
            <p class="text-sm text-center text-zinc-300 dark:text-gray-400 pt-2 mb-6 md:mb-12">
                Укажите текущий пароль и задайте новый
            </p>

            <!-- УВЕДОМЛЕНИЯ -->
            {% if messages %}
            <div class="space-y-2">
                {% for message in messages %}
                {% if "success" in message.tags %}
                <div class="p-3 text-center text-base tracking-wide text-green-700 bg-green-50 rounded-lg">
                    {{ message|linebreaksbr }}
                </div>
                {% else %}
                <div class="p-3 text-center text-base tracking-wide text-pink-700 bg-pink-50 rounded-lg">
                    {{ message|linebreaksbr }}
                </div>
                {% endif %}
                {% endfor %}
            </div>
            {% endif %}

            <!-- ОБЩИЕ ОШИБКИ -->
            {% if form.non_field_errors %}
            <div class="p-3 text-center text-base tracking-wide text-pink-700 bg-pink-50 rounded-lg">
                {% for err in form.non_field_errors %}
                {{ err }}{% if not forloop.last %}<br>{% endif %}
                {% endfor %}
            </div>
            {% endif %}

            <div>
                <form class="space-y-4 md:space-y-6" method="post">
                    {% csrf_token %}

                    <!-- Текущий пароль -->
                    <div>
                        <label for="{{ form.current_password.id_for_label }}"
                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                            {{ form.current_password.label }}
                        </label>
                        {{ form.current_password }}
                        {% if form.current_password.errors %}
                        <p class="mt-2 text-sm text-red-600 dark:text-red-500">
                            {{ form.current_password.errors.0 }}
                        </p>
                        {% endif %}
                    </div>

                    <!-- Новый пароль -->
                    <div>
                        <label for="{{ form.new_password.id_for_label }}"
                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                            {{ form.new_password.label }}
                        </label>
                        {{ form.new_password }}
                        {% if form.new_password.errors %}
                        <p class="mt-2 text-sm text-red-600 dark:text-red-500">
                            {{ form.new_password.errors.0 }}
                        </p>
                        {% endif %}
                    </div>

                    <!-- Подтверждение нового пароля -->
                    <div>
                        <label for="{{ form.new_password_confirm.id_for_label }}"
                               class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">
                            {{ form.new_password_confirm.label }}
                        </label>
                        {{ form.new_password_confirm }}
                        {% if form.new_password_confirm.errors %}
                        <p class="mt-2 text-sm text-red-600 dark:text-red-500">
                            {{ form.new_password_confirm.errors.0 }}
                        </p>
                        {% endif %}
                    </div>

                    <div class="pt-6 md:pt-12">
                        <button type="submit"
                                class="inline-flex items-center justify-center w-full px-6 py-3
                                border border-transparent text-base font-medium rounded-xl text-white bg-indigo-600 hover:bg-indigo-700
                                focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500
                                transition-all duration-200 shadow-md hover:shadow-lg">
                            <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                            Изменить пароль
                        </button>
                    </div>
                </form>

                <!-- Кнопка "Забыл пароль": разлогин и переход на восстановление -->
                <form class="mt-3" method="post"
                      action="{% url 'users:web:logout' %}?next={% url 'users:web:password-reset' %}">
                    {% csrf_token %}
                    <button type="submit"
                            class="w-full px-6 py-3
                            border border-transparent text-base font-medium rounded-xl text-indigo-700 bg-indigo-100 hover:bg-indigo-200
                            focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500
                            transition-all duration-200 shadow-md hover:shadow-lg">
                        Забыли текущий пароль?
                    </button>
                </form>

            </div>

            {% endif %}

        </div>
    </div>

</section>

{% endblock %}
